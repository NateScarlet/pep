# PEP 257 - 文档字符串约定
原文：https://www.python.org/dev/peps/pep-0257

## 摘要

该 PEP 论述了 Python 文档字符串（docstrings）的语义和约定。

## 理论基础

该 PEP 的目的是规范文档字符串的结构：什么应该包含，以及怎么描述（不涉及标记语法）。该 PEP 相当于约定，不是规定或语法规则。

> 一个通用的约定提供所有的一切包括可维护性，明确性，一致性，以及良好编程习惯的基础。
> 唯一没有做的是坚持要求你遵循它，不惜违背自己的意愿。这就是 Python！
>
> —— Tim Peters 写于 comp.lang.python，2001-06-16

如果你违背了这些约定，最多招致一些白眼。
只是有些软件（像 [Docutils](http://docutils.sourceforge.net/) 文档字符串处理系统[[1]](#footnote1)[[2]](#footnote2)）会参考这些约定，
所以遵循这些约定会得到更好地结果。

## 规范

### 什么是文档字符串？

文档字符串是指在模块，函数，类，或成员函数定义出现的，作为第一条语句的字符串字面量。
这样的文档字符串会成为该对象的特殊属性 `__doc__`。

所有的模块通常都应该包含一段文档字符串，通过模块导出的函数和类，
以及公有方法（包括 `__init__` 构造器）也应该具备文档字符串。
一个包可以被文档化，在其目录下的 `__init__.py` 文件里的模块文档字符串。

Python 代码其它地方出现的字符串字面量也可以作为文档。
但它们不会被 Python 字节码编译器识别，也就无法在运行时作为对象属性访问（也就是说，没有赋值到 `__doc__`）。不过，有两种特别的文档字符串可以被软件工具提取：

1. 在顶级模块，类，或 `__init__` 方法里的简单赋值语句后紧接着出现的字符串字面量，
   被称之为“属性文档字符串（attribute docstrings）”

2. 紧接着出现在其他文档字符串后面的字符串字面量，
   被称之为“附加文档字符串（additional docstrings）”

更多关于属性和附加文档字符串的详细描述，请阅读 [PEP 258](https://www.python.org/dev/peps/pep-0258)，“Docutils 设计规范”。

XXX Mention docstrings of 2.2 properties.

为了一致性，总是使用 `"""三双引号"""` 来包含文档字符串。
如果你希望在你的文档字符串里使用反斜杠，那么应该使用 `r"""真·三双引号"""`。
对于 Unicode 文档字符串，使用 `u"""Unicode 三引号字符串"""`。

有两种形式的文档字符串：单行和多行。

### 单行文档字符串

单行文档字符串用于显而易见的情况，它们应该适合写成一行，例如：

```python
def kos_root():
    """Return the pathname of the KOS root directory."""
    global _kos_root
    if _kos_root: return _kos_root
    ...
```

注意：

- 即使是单行也要使用三引号，为的是方便后续扩展。

- 关闭的引号应该和开始的引号在同一行，对于单行，这样看起来更好。

- 文档字符串的开始和结束不应该出现空行

- 描述函数或方法的作用时应该使用命令式短语（“Do this”，
  “Return that”）而不是作为一段描述。比如，不要写“Returns the pathname ...”。

- 单行文档字符串不应该重申函数或方法的参数（因为可以通过 introspection 得到）。
  不要这样：

  ```python
  def function(a, b):
      """function(a, b) -> list"""
  ```
  
  该类型的文档字符串只出现在 C 函数（例如 built-ins），在那里 intropection
  是不可用的。然而，intropection 无法决出原始的*返回值*，
  所以，在文档字符串里应该被提及。推荐的形式是这样的：
  
  ```python
  def function(a, b):
      """Do X and return a list."""
  ```
  

### 多行文档字符串

多行文档字符串的开始是一段摘要，就像单行文档字符串一样，接下来是一个空行，
然后是更多详细描述。摘要可以被自动索引工具所使用；
关键在于，摘要适用于一行，并且使用一个空行与剩下的文档字符串进行区分。
摘要可以与开始引号在同一行或另起一行。
整个文档字字符串的缩进应该与引号齐平（参照下面的示例）

Insert a blank line after all docstrings (one-line or multi-line) that
document a class -- generally speaking, the class's methods are
separated from each other by a single blank line, and the docstring
needs to be offset from the first method by a blank line.

The docstring of a script (a stand-alone program) should be usable as
its "usage" message, printed when the script is invoked with incorrect
or missing arguments (or perhaps with a "-h" option, for "help").
Such a docstring should document the script's function and command
line syntax, environment variables, and files.  Usage messages can be
fairly elaborate (several screens full) and should be sufficient for a
new user to use the command properly, as well as a complete quick
reference to all options and arguments for the sophisticated user.

The docstring for a module should generally list the classes,
exceptions and functions (and any other objects) that are exported by
the module, with a one-line summary of each.  (These summaries
generally give less detail than the summary line in the object's
docstring.)  The docstring for a package (i.e., the docstring of the
package's ``__init__.py`` module) should also list the modules and
subpackages exported by the package.

The docstring for a function or method should summarize its behavior
and document its arguments, return value(s), side effects, exceptions
raised, and restrictions on when it can be called (all if applicable).
Optional arguments should be indicated.  It should be documented
whether keyword arguments are part of the interface.

The docstring for a class should summarize its behavior and list the
public methods and instance variables.  If the class is intended to be
subclassed, and has an additional interface for subclasses, this
interface should be listed separately (in the docstring).  The class
constructor should be documented in the docstring for its ``__init__``
method.  Individual methods should be documented by their own
docstring.

If a class subclasses another class and its behavior is mostly
inherited from that class, its docstring should mention this and
summarize the differences.  Use the verb "override" to indicate that a
subclass method replaces a superclass method and does not call the
superclass method; use the verb "extend" to indicate that a subclass
method calls the superclass method (in addition to its own behavior).

*Do not* use the Emacs convention of mentioning the arguments of
functions or methods in upper case in running text.  Python is case
sensitive and the argument names can be used for keyword arguments, so
the docstring should document the correct argument names.  It is best
to list each argument on a separate line.  For example::

    def complex(real=0.0, imag=0.0):
        """Form a complex number.

        Keyword arguments:
        real -- the real part (default 0.0)
        imag -- the imaginary part (default 0.0)
        """
        if imag == 0.0 and real == 0.0: 
            return complex_zero
        ...

Unless the entire docstring fits on a line, place the closing quotes
on a line by themselves.  This way, Emacs' ``fill-paragraph`` command
can be used on it.


Handling Docstring Indentation
------------------------------

Docstring processing tools will strip a uniform amount of indentation
from the second and further lines of the docstring, equal to the
minimum indentation of all non-blank lines after the first line.  Any
indentation in the first line of the docstring (i.e., up to the first
newline) is insignificant and removed.  Relative indentation of later
lines in the docstring is retained.  Blank lines should be removed
from the beginning and end of the docstring.

Since code is much more precise than words, here is an implementation
of the algorithm::

    def trim(docstring):
        if not docstring:
            return ''
        # Convert tabs to spaces (following the normal Python rules)
        # and split into a list of lines:
        lines = docstring.expandtabs().splitlines()
        # Determine minimum indentation (first line doesn't count):
        indent = sys.maxint
        for line in lines[1:]:
            stripped = line.lstrip()
            if stripped:
                indent = min(indent, len(line) - len(stripped))
        # Remove indentation (first line is special):
        trimmed = [lines[0].strip()]
        if indent < sys.maxint:
            for line in lines[1:]:
                trimmed.append(line[indent:].rstrip())
        # Strip off trailing and leading blank lines:
        while trimmed and not trimmed[-1]:
            trimmed.pop()
        while trimmed and not trimmed[0]:
            trimmed.pop(0)
        # Return a single string:
        return '\n'.join(trimmed)

The docstring in this example contains two newline characters and is
therefore 3 lines long.  The first and last lines are blank::

    def foo():
        """
        This is the second line of the docstring.
        """

To illustrate::

    >>> print repr(foo.__doc__)
    '\n    This is the second line of the docstring.\n    '
    >>> foo.__doc__.splitlines()
    ['', '    This is the second line of the docstring.', '    ']
    >>> trim(foo.__doc__)
    'This is the second line of the docstring.'

Once trimmed, these docstrings are equivalent::

    def foo():
        """A multi-line
        docstring.
        """

    def bar():
        """
        A multi-line
        docstring.
        """


References and Footnotes
========================

.. [1] PEP 256, Docstring Processing System Framework, Goodger
   (http://www.python.org/dev/peps/pep-0256/)

.. [2] PEP 258, Docutils Design Specification, Goodger
   (http://www.python.org/dev/peps/pep-0258/)

.. _Docutils: http://docutils.sourceforge.net/

.. _Python Style Guide:
   http://www.python.org/dev/peps/pep-0008/

.. _Doc-SIG: http://www.python.org/sigs/doc-sig/


Copyright
=========

This document has been placed in the public domain.


Acknowledgements
================

The "Specification" text comes mostly verbatim from the `Python Style
Guide`_ essay by Guido van Rossum.

This document borrows ideas from the archives of the Python Doc-SIG_.
Thanks to all members past and present.
